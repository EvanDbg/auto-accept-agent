# 产品需求文档 (PRD) — Auto Accept for Antigravity

**版本**: v1.0
**日期**: 2026-02-19
**状态**: 基于现有实现整合

---

## 1. 产品概述

Auto Accept Agent 是一款 VS Code / Antigravity / Cursor IDE 扩展，通过 Chrome DevTools Protocol (CDP) 自动化 AI 代理的审批流程，让多个代理对话无需人工干预即可持续运行。

---

## 2. 核心需求

### 2.1 自动接受 (Auto Accept)

| ID | 需求 | 状态 |
|----|------|------|
| [REQ-001] | 自动接受文件编辑操作 | ✅ 已完成 |
| [REQ-002] | 自动执行终端命令 | ✅ 已完成 |
| [REQ-003] | 自动确认重试提示 | ✅ 已完成 |
| [REQ-004] | 自动恢复卡住的代理 | ✅ 已完成 |
| [REQ-005] | 危险命令拦截 (如 `rm -rf /`) | ✅ 已完成 |

#### 验收标准 [REQ-001]:
```gherkin
Given 扩展已激活且 Auto Accept 为 ON
When AI 代理提交一个文件编辑请求并出现 Accept 按钮
Then 扩展应在 pollFrequency 时间内自动点击 Accept 按钮
```

#### 验收标准 [REQ-005]:
```gherkin
Given Pro 用户配置了自定义拦截命令列表
When AI 代理提交的终端命令匹配拦截模式
Then 扩展应阻止自动执行并提示用户手动审批
```

---

### 2.2 后台模式 (Background Mode)

| ID | 需求 | 状态 |
|----|------|------|
| [REQ-010] | 同时运行多个 Antigravity 标签页 | ✅ 已完成 (Pro) |
| [REQ-011] | 后台标签自动接受 (无需切换) | ✅ 已完成 (Pro) |
| [REQ-012] | 后台模式 UI 叠加层显示对话状态 | ✅ 已完成 |
| [REQ-013] | 多窗口支持 | ✅ 已完成 (Pro) |

---

### 2.3 CDP 连接管理

| ID | 需求 | 状态 |
|----|------|------|
| [REQ-020] | 智能端口检测 (9000 ± 3 范围扫描) | ✅ 已完成 |
| [REQ-021] | 跨平台自动配置 CDP 端口 | ✅ 已完成 |
| [REQ-022] | 手动 CDP 端口配置支持 | ✅ 已完成 |
| [REQ-023] | CDP 断线自动重连 | ✅ 已完成 |

---

### 2.4 IDE 重启与配置 (Relauncher)

| ID | 需求 | 状态 |
|----|------|------|
| [REQ-030] | Windows 快捷方式自动修改 | ✅ 已完成 |
| [REQ-031] | macOS 快捷方式提示 | ✅ 已完成 |
| [REQ-032] | Linux .desktop 文件修改 | ✅ 已完成 |
| [REQ-033] | Windows 注册表上下文菜单修改 | ✅ 已完成 |

---

### 2.5 设置面板 (Settings Panel)

| ID | 需求 | 状态 |
|----|------|------|
| [REQ-040] | WebView 设置界面 | ✅ 已完成 |
| [REQ-041] | Pro 许可证验证 (Stripe 集成) | ✅ 已完成 |
| [REQ-042] | 轮询频率配置 (Pro) | ✅ 已完成 |
| [REQ-043] | 禁用命令列表配置 (Pro) | ✅ 已完成 |
| [REQ-044] | ROI 统计展示 | ✅ 已完成 |

---

### 2.6 状态指示

| ID | 需求 | 状态 |
|----|------|------|
| [REQ-050] | 状态栏 ON/OFF 切换显示 | ✅ 已完成 |
| [REQ-051] | 紫色 = 进行中，绿色 = 完成 | ✅ 已完成 |
| [REQ-052] | 后台模式状态指示器 | ✅ 已完成 |

---

### 2.7 国际化 (i18n)

| ID | 需求 | 状态 |
|----|------|------|
| [REQ-060] | 英文支持 | ✅ 已完成 |
| [REQ-061] | 简体中文支持 | ✅ 已完成 |
| [REQ-062] | 自动语言检测 | ✅ 已完成 |
| [REQ-063] | 手动语言覆盖设置 | ✅ 已完成 |

---

### 2.8 分析与统计 (Analytics)

| ID | 需求 | 状态 |
|----|------|------|
| [REQ-070] | 点击统计 (文件编辑/终端命令) | ✅ 已完成 |
| [REQ-071] | ROI 时间节省计算 | ✅ 已完成 |
| [REQ-072] | 周报通知 | ✅ 已完成 |
| [REQ-073] | 会话结束摘要通知 | ✅ 已完成 |
| [REQ-074] | 离开期间操作通知 | ✅ 已完成 |

---

### 2.9 已规划需求

| ID | 需求 | 状态 |
|----|------|------|
| [REQ-080] | Run 按钮自动点击 (新版选择器适配) | ✅ 已完成 |
| [REQ-081] | 面板滚动修复 (Requires Input 可视) | ✅ 已完成 |
| [REQ-082] | 启动时自动打开最后对话 | ⚠️ 方案已定 (待实现) |

---

## 3. 非功能需求

| ID | 需求 | 描述 |
|----|------|------|
| [NFR-001] | 兼容性 | 支持 VS Code ≥ 1.75、Antigravity、Cursor |
| [NFR-002] | 性能 | 轮询间隔最低 2s (Free) / 可调 (Pro) |
| [NFR-003] | 安全性 | 危险命令拦截、实例锁防重入 |
| [NFR-004] | 可用性 | 一键启用、静默运行 |
